<div id='locationMap'></div>
<script type='text/javascript'>
	var clientContext = new SP.ClientContext(_spPageContextInfo.webServerRelativeUrl);
	var oList = clientContext.get_web().get_lists().getByTitle('Project Statement');
	var camlQuery = new SP.CamlQuery();
	this.collListItem = oList.getItems(camlQuery);
	clientContext.load(collListItem);
	clientContext.executeQueryAsync(Function.createDelegate(this, this.onSucceeded),
		Function.createDelegate(this, this.onQueryFailed));

	function onSucceeded(sender, args) {
		var bwProjectNum = '';
		var listItemEnumerator = collListItem.getEnumerator();
		while (listItemEnumerator.moveNext()) {
			var oListItem = listItemEnumerator.get_current();
			bwProjectNum = oListItem.get_item('BrightWorkProjectNumber');
			console.log("Brightwork Project Number: " + bwProjectNum);
		}
		if (bwProjectNum) {
			bwProjectNum = bwProjectNum.match(/\d+$/g);
			console.log("Map Project Number: " + bwProjectNum);
			document.getElementById('locationMap').innerHTML = 
				"<iframe src='https://gis.co.carver.mn.us/embedded_apps/pw_project_registry/project_registry.html?proj_ID=" + 
					bwProjectNum + "' style='width:100%;height:450px;'></iframe><br>" + 
					"<a href='https://gis.co.carver.mn.us/embedded_apps/pw_project_registry/project_registry.html?proj_ID=" + 
					bwProjectNum + "' target='_blank'>View Larger Map</a>";
		} else {
			document.getElementById('locationMap').innerHTML = 
				"<div style='color:red;font-weight:bold;'>Please enter a Brightwork Project Number into the Project Statement.</div>";
		}
	}		

	function onQueryFailed(sender, args) {
		document.getElementById('locationMap').innerHTML = 
			"<div style='color:red;font-weight:bold;'>An error has occurred.<br>Please review the browser console (F12) for details.</div>";
		console.log('Project Location Map Error: ' + args.get_message() + '\n' + args.get_stackTrace());
	}
</script>
